# 用户ID匹配中间件详细接口文档

## 概述

用户ID匹配中间件主要用于验证请求中的用户ID是否与通过JWT认证获得的用户ID一致。此机制确保了用户只能访问或修改与其ID匹配的资源，增强了接口的安全性。

## 功能流程

1. **验证用户ID存在性**：首先检查Gin上下文中是否存在`user_id`。这个`user_id`应该是在前一个JWT认证中间件中被注入的。如果`user_id`不存在，则请求被认定为未授权访问。

2. **校验URL中的用户ID**：接着，从URL参数中获取`user_id`并验证其是否为有效的整数。这一步确保了`user_id`参数的格式正确性和合法性。

3. **比较两个用户ID**：最后，比较上下文中的`user_id`与URL参数中的`user_id`是否一致。只有当两者匹配时，才允许请求继续执行后续的业务逻辑。

## 错误处理

- **未授权访问**：如果在Gin上下文中找不到`user_id`，将返回`401 Unauthorized`状态码，并提示未授权访问。

  ```json
  {
    "error": "未授权访问"
  }
  ```

  日志记录示例：

  ```
  未授权访问,context中未能找到JWT中间件中注入的user_id
  请求IP: 请求发起者的IP
  请求url: 请求的URL
  ```

- **无效的用户ID**：如果URL参数中的`user_id`不是有效的整数，将返回`400 Bad Request`状态码，并提示无效的用户ID。

  ```json
  {
    "error": "无效的用户ID"
  }
  ```

  日志记录示例：

  ```
  无效的用户ID,URL参数中的user_id不是有效的整数
  请求IP: 请求发起者的IP
  请求url: 请求的URL
  ```

- **用户ID不匹配**：如果URL参数中的`user_id`与Gin上下文中的`user_id`不一致，将返回`403 Forbidden`状态码，并提示无权访问此资源。

  ```json
  {
    "error": "无权访问此资源,因为token中的user_id与URL参数中的user_id不匹配"
  }
  ```

  日志记录示例：

  ```
  无权访问此资源,因为token中的user_id与URL参数中的user_id不匹配
  token中的user_id: JWT认证中间件注入的用户ID
  URL参数中的user_id: 请求URL中的用户ID
  请求IP: 请求发起者的IP
  请求url: 请求的URL
  ```

## 应用场景

此中间件适用于需要根据用户ID限制访问权限的场景，例如用户个人资料的获取和编辑、用户特定资源的访问等。

## 注意事项

- 确保在此中间件之前已经执行了JWT认证中间件，并且成功将`user_id`注入Gin上下文。
- 使用此中间件可以有效防止用户访问或修改非自己拥有的资源，是一种重要的安全措施。